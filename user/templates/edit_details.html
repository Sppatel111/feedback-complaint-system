{% extends "settings.html" %}
{% set active_tab = 'edit' %}

{% block settings_content %}
<style>
    .profile-pic-wrapper {
        position: relative;
        width: 120px;
        height: 120px;
        margin: 0 auto 1rem auto;
    }

    .profile-pic-wrapper img {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 50%;
        border: 3px solid #dee2e6;
        box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }

    .upload-icon {
        position: absolute;
        bottom: 0;
        right: 0;
        background: #fff;
        border-radius: 50%;
        padding: 6px;
        cursor: pointer;
        box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }

    .upload-icon:hover {
        background: #e9ecef;
    }

    input[type="file"] {
        display: none;
    }
</style>

<div class="card shadow border-0">
    <div class="card-body">
        <h4 class="card-title mb-4">Edit Your Details</h4>
        <form method="POST" enctype="multipart/form-data">
            {{ form.hidden_tag() }}

            <div class="text-center mb-3">
                <div class="profile-pic-wrapper">
                    <img id="profile-preview"
                         src="{{ url_for('user.static', filename='assets/profiles/' + (current_user.user_detail.profile_image or 'default-profile.jpg')) }}"
                         alt="Profile Image">
                    <label for="profileImage" class="upload-icon border">
                        <i class="fas fa-camera"></i>
                    </label>
                    {{ form.profile_image(id='profileImage') }}
                </div>
                <small class="text-muted">Click the icon to change profile picture</small>
            </div>

            <div class="form-group">
                {{ form.email.label(class="form-label") }}
                {{ form.email(class="form-control", readonly=True) }}
            </div>

            <div class="form-group">
                {{ form.department.label(class="form-label") }}
                {{ form.department(class="form-control", readonly=True) }}
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    {{ form.f_name.label(class="form-label") }}
                    {{ form.f_name(class="form-control") }}
                </div>
                <div class="form-group col-md-6">
                    {{ form.l_name.label(class="form-label") }}
                    {{ form.l_name(class="form-control") }}
                </div>
            </div>

            <div class="form-group">
                {{ form.phone.label(class="form-label") }}
                {{ form.phone(class="form-control") }}
            </div>
            <button type="submit" class="btn btn-sm btn-outline-primary d-flex align-items-center gap-1 mt-1">Update Details</button>
        </form>
    </div>
</div>

<script>
    // Preview selected image
    const input = document.getElementById('profileImage');
    const preview = document.getElementById('profile-preview');

    input.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            preview.src = URL.createObjectURL(file);
        }
    });
</script>
{% endblock %}
